<?php

// fecth items independently of title

require_once('../config.inc.php');
require_once('../lib.php');

$items=array(
220752,
220961,
220914,
220896,
220891, // Bollettino malacologico. v.50:no.2 (2014)
220873, // Bollettino malacologico. v.50:no.1 (2014)
220796,

// Nautilis 2014
220795,
220794,
220793,

220748

);

$items=array(
164142,
214799,
80120,
80241
);

$items=array(
221112, // Iberus

221139, // MQM

221120, // Revue Suisse
221123,
221125,
221126,
221130,

220748,
220896,
221138,
221249,
221291,
221298,
221299,
221305






);

$items=array(
228125,
228338,
228350,
228022,
228076,
228077,
228148,
228157,
228171
);

$items=array(
247510,
247508,
247507,
247503,
247501,
247500,
247499,
247480,
247450,
247439,
247437,
247436,
247428,
247419,
247418,
247410,
247396,
247395,
247393,
247384,
247383,
247382,
247381,
247380,
247371,
247370,
247369,
247368,
247367,
247365,
247362,
247360,
247357,
247351,
247350,
247349,
247342,
247341,
247338,
247336,
247335,
247334,
247333,
247332,
247331,
247330,
247329,
247327,
247326,
247323,
247321,
247320


);

$items=array(

249861,
249644,
250197,

// Beagle
250572,
250571,
249858,
249857,

// JLR
238256,
238292,
238299,
238345,
250172,
250203,
250204,
250210,
250247,
250256,
250261,
250274,
250605,

250313,
250532,

250644



);

$items=array(
251571,
251659,
251679,
251680,
251700,
251701,
251724,
251727,
251728,
251750,
251751,
251755,
251756,
251758,
251759,
251819,
251821,
251822,
251823,

251525,
251702,
251708,
251710,
251711,
251719,
251720,
251726,
251794



);

$items=array(
251819,
251821,
251822,
251823,
252098,
252099,
252121,
252137,
252138,
252168,
252169,
252170,
252171,
252172,
252178,
252179
);

$items=array(
229071,
229101,
229127,
229128,
252377,
252378,
252393,
252407,
252425,
252426,
252483,
252484,

252098,
252099,
252121,
252137,
252138,
252168,
252169,
252170,
252171,
252172,
252178,
252179,
252305,
252368,
252371,
252418,
252439,
252440,
252442,
252465,
252480,
252494,

252458,

251525,
251702,
251708,
251710,
251711,
251719,
251720,
251726,
251794,
252100,
252101,
252133,
252139,
252180,
252181,
252211,
252216,
252295,
252297,
252343,
252350,
252485




);

$items=array(

252377,
252378,
252393,
252407,
252425,
252426,
252483,
252484,
252643,
252645,
252648,
252650,
252651,
252691,
252797,
252798,

252799,
252800,

252700




);

$items=array(
245522,
245524,
245551,
245560,
245564,
245599,
245824,
245892,
245905,
245912,
245915
);

$items=array(
206985,
206244,
206091,
206245,
229071,
229101,
229127,
229128,
252425,
252426,
252377,
252378,
252797,
252691,
252651,
252483,
252648,
252650,
252484,
252643,
252798,
252407,
252393,
252645





);

$items=array(
258505,
258553,
258570,
258571,
258572,
258578,
258579,
258580,
258601,
258615,
258616,
258617,
258618
);

$items=array(
259210,
259155,
229687,
257290,
257301,
257320,
257326,
257327,
257347,
257394,
257402,
257468,
259184

);

$items=array(
259923,
259920,
259924,
259927,
259928,
259938,
259939,
259949,
260015,
260105,
260106,
260109,
260137,
259953,
259964,
259985,
260005,
260012,
260014,
260027,
260037,
260043,
260044,
260045,
260062,
260065,
260070,
260071
);

$items=array(
259953,
259964,
259985,
260005,
260012,
260014,
260027,
260037,
260043,
260044,
260045,
260062,
260065,
260070,
260071
);

$items=array(
260363,
260364,
260378,
260379,
260380,
260381,
260408,
260428,
260499
);

$items=array(
260015,
260731,
260771,
260772,
260775,
260824,
260826,
260827,
260844,
260851,

260137,
260722,
260723,
260725,
260737,
260747,
260748,
260811,
260839,
260840,
260842,

260709,
260727,
260728,
260751,
260756,
260757,
260763,
260766,
260773,
260784,
260825,
260832,
260846,
260847,
260850,
260854,



);

$items=array(
260709,
260727,
260728,
260751,
260756,
260757,
260763,
260766,
260773,
260784,
260825,
260832,
260846,
260847,
260850,
260854,

);

$items=array(
/*260955,

260947,
260959,
260981,
261003,
261006,
261011,
261029,
261047,
261048,
261065,
261069,
261075,
261090,
261093,

260975,
261004,
261005,
261061,
261063,
261072,
261085,
261086, */

// Mem Nat Hist
260972,
260983,
261081,

// Bull MNH
260942,
261001,
261002,
261013,
261024,
261027,
261028,
261032,
261078,
261079,

);

$items = array(
/*
// Rio
261341,
261402,
261428,
261445,
*/

// Bull MNH
261305,
261333,
261355,
261356,
261357,
261382,
261383,
261389,
261394,
261408,
261429,
261431,

// Mem MNH
261174,
261176,
261202,
261205,
261206,
261208,
261209,
261327,
261330,
261331,
261342,
261343,
261365,
261366,
261367,
261377,
261381,
261385,
261411,
261423,

/*
// Viv
261374,
261384,
*/

);

$items = array(
// rio
261553,
261590,
261591,
261592,
261599,
261600,
261601,
261616,
261652,
261653,
261656,
261657,
261662,
261663,
261667,
261733,
261743,
261802,
261812,
261831,
261832,

// BMZ
261510,
261519,
261520,
261566,
261678,
261685,
261691,
261756,
261773,
261817,
261823,
261825,
261830,

// Mem

261659,
261660,
);


$items = array(

// bmnhn
261940,
261941,


// rio
261937,

// pcas
261935,
);

$items = array(
254261
);

$items = array(

262122, // Records of the Queen Victoria Museum Launceston

262143, // Proceedings of the Royal Society of Victoria. New series

262156, // Memoirs of the Queensland Museum

// Rio
262120,
262128,
262129,

// BMNHN
262121,

// Mem
262127,
262131,
262132,
262138,
262139,
262140,
262141,
262142,
);

$items = array(
// Rio
262219,

// Mem
262186,
262188,
262190,
262192,
262194,
262198,
262199,
262200,
262201,
262202,
262203,
262204,
262205,
);

$items=array(
7150,
7151,
7152,
7153,
7154,
7155,
7156,
7157,
7158,
7159,
7160,
7161,
7162,
7163,
109211,
7165,
7166,
7167,
7168,
7169,
);

$items=array(
262252,

// Mem Z
262232,

// Rio
262241,
262242,
262248,
262249,
262250,

);

$items=array(

// Mem Z
262232,
262311,
262319,



// Bull MNHN
261940,
261941,
261830,
261817,
261773,
262307,
262329,
262322,
262330,
262315,
262308,
262328,
262326,
262317,
262300,
262316,
262301,
262320,
262331,
262310,


// Rio
262294,
262295,
262325,



);

$items=array(

// Mem Z

	262355,
	262371,
	262437,
	262438,
	262461,
	262474,
	262477,
	262478,
	262483,

);


$items=array(
224905
);

$items=array(
// Rio
262920,

// Mem Z
262733,
262734,
262736,
262737,
262738,
262759,
262761,
262766,
262767,
262768,
262782,
262785,
262879,
262882,
262883,
262884,



// Bull
262732,
262781,
262817,
262824,
262831,
262841,
262842,
262870,
262890,
262900,
262901,
262902,
262917,
262921,
262922,

);

$items = array(
263407,
263401,
263400,
263399,
263397,
263395,
263394,
263392,
263387,
263386,
263383,
263379,
263373,
263372,
263371,
263370,
263369,
263367,
263366,
263362,
263361,
263360,
263353,
263352,
263348,
263347,
263346,
263345,
263344,
263343,
263342,
263341,
263338,
263337,
263336,
263329,
263325,
263324,
263323,
263322,
263320,
263317,
263315,
263313,
263312,
263308,
263307,
263306,
263305,
263303,
263300,
263299,
263297,
263296,
263295,
263294,
263293,
263283,
263282,
263281,
263280,
263279,
263275,
263274,
263272,
263271,
263269,
263268,
263267,
263266,
263265,
263262,
263259,
263258,
263254,
263253,
263251,
263250,
263248,
263247,
263245,
263243,
263242,
263241,
263240,
263236,
263234,
263232,
263231,
263229,
263228,
263227,
263226,
263225,
263224,
263220,
263219,
263218,
263217,
263216,
263215,
263214,
263213,
263212,
263209,
263208,
263207,
263206,
263205,
263203,
263199,
263198,
263197,
263196,
263195,
263194,
263193,
263191,
263180,
263178,
263177,
263176,
263175,
263173,
263172,
263171,
263167,
263166,
263165,
263164,
263163,
263162,
263161,
263159,
263158,
263157,
263156,
263155,
263154,
263151,
263150,
263149,
263147,
263145,
263144,
263082,
263075,
263068,
263055,
263052,
263048,
263040,
263031,
263015,
263012,
263011,
263010,
262999,

// Rio
263179,

// MZ
263147,
263198,
263199,
263203,
263205,
263216,
263231,
263241,
263243,
263266,
263267,
263271,
263272,
263275,
263279,
263305,
263325,
263352,
263361,
263362,
263383,
263386,
263392,
263399,
263400,
263401,


// Bull
263144,
263145,
263149,
263150,
263154,
263155,
263157,
263158,
263161,
263162,
263163,
263164,
263166,
263167,
263171,
263172,
263173,
263176,
263177,
263178,
263180,
263194,
263206,
263207,
263208,
263209,
263217,
263218,
263219,
263220,
263226,
263232,
263247,
263248,
263293,
263295,
263296,
263297,
263312,
263313,
263366,
263367,


);


$items=array(
264108,
264071,
264038,
264030,
264027,
264026,
264024,
263977,
263922,
263921,
263920,
263910,
263900,
263874,
263869,
263851,
263850,
263848,
263833,
263728,
263727,
263726,
);

$items=array(
264419,
264379,
264304,
264302,
);

$items=array(
264445,
264418,
264412,
264411,
264398,
264397,
264396,
264395,
264394,
264393,
264392,
264389,
264388,
264384,
264383,
264378,
264377,
264376,
264374,
264373,
264372,
264366,
264365,
264364,
264363,
264362,
264361,
264360,
264345,
264344,
264341,
264340,
264339,
264338,
264337,
264336,
264335,
264321,
264320,
264319,
264316,
264309,
264308,
264307,
264306,
264282,
264281,
264280,
264274,
264273,
264258,
264257,
264256,
264255,
264254,
264253,
264250,
264248,
264247,
264246,
264245,
264242,
264241,
264240,
264239,
264238,
264237,
264236,
264235,
264234,
264233,
264232,
264231,
264217,
264216,
264215,
264214,
264213,
264208,
264194,
264193,
264191,
264190,
264189,
264188,
264187,
264186,
264185,
264183,
264182,
264181,
264180,
264179,
264178,
264175,
264108,
264071,
264038,
264030,
264027,
264026,
264024,
263977
);

// Psyche 86 & 87
$items=array(
264032,
264051,
);

$items=array(
264738,
264739,
264740,
264741,
264853,
264857,
264858,
264859,
264924,
264925,
264926,

264468,
264576
);

$items = array(
264963,
264952,
264947,
264923,
264922,
264897,
264882,
264881,
264856,
264855,
264847,
264824,
264813,
264811,
264810,
264808,
264793,
264791,
264786,
264743,
264735,
264734,
264720,
264693,
264692,
264691,
264689,
264688,
264659,
264626,
264602,
264601,
264600,
264490,
264489,
264488,
264487,
264485,
264482,
264481
);

$items=array(
264175,
264215,
264216,
264240,
264241,
264242,
264247,
264248,
264254,
264255,
264335,
264337,
264338,
264339,
264344,
264345,
264360,
264361,
264373,
264374,
264471,
264481,
264488,
264600,
264601,
264602,
264659,
264688,
264689,
264692,
264693,
264720,
264791,
264793,
264810,
264811,
264813,
264855,
264856,
264881,
264882,
264897,
264947,
);

$items=array(
263562,
263631,
263632,
263651,
263833,
263848,
263900,
263920,
263921,
263922,
264024,
264026,
264027,
264038,
264108,
264250,
264274,
264383,
264384,
264393,
264395,
264411,
264412,
264418,
264445,
264626,
264691,
264734,
264735,
264743,
264786,
264808,
264824,
264847,
264922,
264923,
264952,
264963,
);

$items=array(

// Rio 
265305,



// MZ
265127,
265150,
265207,
265213,
265233,
265261,
265310,
265366,
265387,





);

$items=array(
/*
// Ent Ber
265471,

// Telopea
265128,
265164,
265285,
265354,
265389,
265476,
265495,
265516,
265523,

// J R Soc W A
256956,
257517,
257518,
257904,
259938,
265424,
265425,
265473,
265484,
265490,
265491,
265492,
265496,
265497,
265517,
265518,
265521, */

// MZ
265427,
265429,
265446,
265470,
265472,
265485,
265486,
265498,
265499,
265501,
265522,



);

$items=array(
// Madrano
/*
202912,
202910,
202840,
202937,
225972,
265709,
265830,
265715,
265716,
*/

//265471,
//265610,

//265868

// MZ
/*265651,
265604,
265603,
265605,
265634,
265654,
265615,
265616,
265613,
265653,
265783,
265824,
265825,
265826,
265784,
265819,
265785,
265792,
265798,
265721,
265770,
265773,
265855,
265856,
265881,
265884,*/

// B

265577,
265578,
265580,
265581,
265582,
265607,
265608,
265609,
265620,
265621,
265622,
265623,
265624,
265642,
265647,
265648,
265706,


);

$items=array(
// MZ
265881,
265884,
265975,
266000,
266004,
266010,
266011,
266012,

// BMNZ
265946,
265947,
265948,
265949,
265950,
265951,
265953,
265954,
265955,

);

$items=array(
// Telopea
266176,

// B
266115,
266121,
266130,
266152,
266153,
266164,
266168,
266183,
266184,
266186,



);

$items=array(
// Forktail
266930,
266922,
266854,

// Novapex
223563,
223564,
266911,
266936,

// Telopea
265570,
266426,
266381,
266345,
266848,
266864,
266865,
266876,
266892,
266906,
266934,

// B
266609,
266653,
266666,
266678,
266697,
266844,
266857,
266858,
266926,

// Entomologische berichten
266836,
266838,
266842,
266855,
266868,
266869,
266881,
266882,
266884,
266896,
266904,
266905,
266912,
266915,
266929,
266940,
266951,


);


foreach ($items as $item)
{
	$url = 'https://www.biodiversitylibrary.org/api2/httpquery.ashx?op=GetItemMetadata&itemid=' . $item . '&pages=t&apikey=' . '0d4f0303-712e-49e0-92c5-2113a5959159' . '&format=json';

	$json = get($url);
	
	//echo $url;

	$obj = json_decode($json);

	//print_r($obj);
	//exit();

	if (($obj->Status == 'ok') && ($obj->Result != '')) // ok doesn't mean we have anything :(
	{
	
		// Item
		$sql = "DELETE FROM bhl_item WHERE ItemID=" . $obj->Result->ItemID . ";";
		echo $sql . "\n";
	
		$sql = "INSERT INTO bhl_item(ItemID,TitleID,VolumeInfo) VALUES("
		. $obj->Result->ItemID . ',' . $obj->Result->PrimaryTitleID . ",'" . addslashes($obj->Result->Volume) . "');";
	
		echo $sql . "\n";
	
		$sql = 'DELETE FROM bhl_page WHERE ItemID=' . $obj->Result->ItemID . ";";
		echo $sql;
	
		// Pages
		foreach ($obj->Result->Pages as $k => $v)
		{
		
			// print_r($v);
		
			// Metadata about pages
			$keys = array();
			$values = array();
		
			// PageID
			$keys[] = 'PageID';
			$values[] = $v->PageID;
		
			// ItemID
			$keys[] = 'ItemID';
			$values[] = $v->ItemID;

			// Is page numbered?
			if (count($v->PageNumbers) > 0)
			{
				$keys[] = 'PagePrefix';
				$values[] = '"' . $v->PageNumbers[0]->Prefix . '"';

				$keys[] = 'PageNumber';
				$values[] = '"' . $v->PageNumbers[0]->Number . '"';
			}

			if (count($v->PageTypes) > 0)
			{
				$keys[] = 'PageTypeName';
				$values[] = '"' . $v->PageTypes[0]->PageTypeName . '"';
			}
			$sql = 'DELETE FROM bhl_page WHERE PageID=' . $v->PageID . ';';
			//echo $sql . "\n";
			$sql = 'INSERT INTO bhl_page (' . implode (",", $keys) . ') VALUES (' . implode (",", $values) . ');';
			echo $sql . "\n";
	
	
			// Order of pages
			// pages has PageID as primary key
			$sql = 'REPLACE INTO page (PageID,ItemID,FileNamePrefix,SequenceOrder) VALUES ('
				.        $v->PageID
				. ','  . $v->ItemID
				. ',"' . $obj->Result->SourceIdentifier . sprintf("_%04d",  ($k+1)) . '"'
				. ','  . ($k+1)
				. ');';
			
			echo $sql . "\n";
			
		} 
	}
}

?>