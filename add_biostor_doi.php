<?php

// Add BHL DOIs for BioStor articles
require_once (dirname(__FILE__) . '/lib.php');

//----------------------------------------------------------------------------------------
function get_part_from_biostor($id)
{
	$config['api_key'] = '0d4f0303-712e-49e0-92c5-2113a5959159';
	
	$part = null;
	
	$parameters = array(
		'op' 	=> 'GetPartByIdentifier',
		'type' 	=> 'biostor',
		'value' => $id,
		'apikey'	=> $config['api_key'],
		'format'	=> 'json'
	);
	
	$url = 'https://www.biodiversitylibrary.org/api2/httpquery.ashx?' . http_build_query($parameters);
	
	//echo $url . "\n";
	
	$json = get($url);
	
	$obj = json_decode($json);
	
	if ($obj && isset($obj->Result))
	{
		if (count($obj->Result) == 1)
		{
			$part = $obj->Result[0];
		}
	}
	
	return $part;
	
}

//----------------------------------------------------------------------------------------

$ids = array(
163904,
163905,
163906,
163907,
163908,
163909,
163910,
163911,
163912,
163913,
163914,
163915,
163916,
163917,
163918,
164083,
164084,
164085,
164086,
164087,
164088,
164089,
164090,
164091,
164092,
164093,
164094,
164095,
164096,
164097,
164098,
164099,
164100,
164101,
164102,
164103,
164104,
164105,
164106,
164107,
164108,
164109,
164110,
164111,
164112,
164113,
164114,
164115,
164116,
164117,
164118,
164119,
164120,
164121,
164122,
164123,
164124,
164125,
164126,
164127,
164128,
164129,
164130,
164131,
164132,
164133,
164134,
164135,
164136,
164137,
164138,
164139,
164140,
164141,
164142,
164143,
164144,
164145,
164146,
164147,
164148,
164149,
164150,
164151,
164152,
164153,
164154,
164155,
164156,
164157,
175527,
175528,
175529,
175530,
175531,
175532,
175533,
175534,
175535,
175536,
175537,
175538,
175539,
175540,
175541,
175542,
175543,
175544,
175545,
175546,
175547,
175548,
175549,
175550,
175551,
175552,
175553,
175554,
175555,
175556,
175557,
175558,
175559,
175560,
175561,
175562,
175563,
175564,
175565,
175566,
175567,
175568,
175569,
175570,
175571,
175572,
175573,
175574,
175575,
175576,
175577,
175578,
175579,
175580,
175581,
175582,
175583,
175584,
175585,
175586,
175587,
175588,
175589,
175590,
175591,
175592,
181791,
181792,
181793,
181794,
181795,
181796,
181797,
181798,
181799,
189554,
189555,
189556,
189557,
189558,
189559,
189560,
189561,
189562,
189563,
189564,
189565,
189566,
189567,
189568,
189569,
189570,
189571,
189572,
189573,
189574,
189575,
189576,
189577,
189578,
189579,
189580,
189581,
189582,
189583,
189584,
189585,
189586,
189587,
189588,
189589,
189590,
189591,
189592,
189593,
189594,
189595,
189596,
189597,
189598,
189599,
189600,
189601,
189602,
189603,
189604,
189605,
189606,
189607,
189608,
189609,
189610,
189611,
189612,
189613,
189614,
189615,
189616,
189617,
189618,
189619,
189620,
189621,
189622,
189623,
189624,
189625,
189626,
189627,
189628,
189629,
189630,
189631,
189632,
189633,
189634,
189635,
189636,
189637,
189638,
189639,
189640,
189641,
189642,
189643,
189644,
189645,
189646,
189647,
189648,
189649,
189650,
189651,
189652,
189653,
189654,
189655,
189656,
189657,
189658,
189659,
189660,
189661,
189662,
189663,
189664,
189665,
189666,
189667,
189668,
189669,
189670,
189671,
189672,
189673,
189674,
189675,
189676,
189677,
189678,
189679,
189680,
189681,
189682,
189683,
189684,
189685,
189686,
225627,
225628,
225629,
225630,
225631,
225632,
225633,
225636,
225637,
225638,
225639,
225640,
225641,
225642,
225643,
225644,
225645,
225646,
225647,
225648,
225649,
225650,
225651,
225652,
225653,
225654,
225655,
225656,
225657,
225658,
225659,
225660,
225661,
225662,
225663,
225664,
225665,
225666,
225667,
225668,
225669,
225670,
225671,
225672,
225673,
225674,
225675,
226368,
226369,
226370,
226371,
226372,
226373,
226374,
226375,
226376,
226377,
226378,
226379,
226380,
226381,
226382,
226383,
226384,
226385,
226386,
226387,
226388,
226389,
226390,
226391,
226392,
226393,
226394,
226395,
226396,
226397,
226398,
226399,
226400,
226401,
226402,
226403,
226404,
240497,
240498,
240499,
240500,
240501,
240502,
240503,
240504,
240505,
240506,
240507,
240736,
240737,
240738,
240739,
240740,
240741,
240742,
240743,
240744,
240745,
240746,
240747,
240748,
253391,
253392,
253393,
253394,
253395,
253396,
253397,
253398,
253399,
253400,
253401,
253402,
253403,
253404,
253427,
253428,
253429,
253430,
253431,
253432,
253433,
253434,
253435,
253436,
253437,
253438,
253439,
253440,
253441,
253442,
253443,
253444,
253445,
253446,
253447,
253448,
253449,
253450,
253451,
253452,
253453,
253454,
253455,
253552,
253553,
253554,
253555,
253556,
253557,
253558,
253559,
253560,
253561,
253562,
253563,
253564,
253565,
253566,
253567,
253568,
253569,
253570,
253571,
253572,
253573,
253574,
253575,
253576,
253577,
253578,
253579,
253580,
253581,
253582,
253583,
253584,
253585,
253586,
253587,
253588,
253589,
253590,
253591,
253592,
253593,
253832,
253833,
253834,
253835,
253836,
253837,
253838,
253839,
253840,
253841,
253842,
253843,
253844,
253845,
253846,
253847,
253848,
253849,
253850,
253851,
253852,
253853,
253854,
253855,
253856,
253857,
253858,
253859,
253860,
253861,
253862,
253863,
253864,
253865,
253866,
253867,
253868,
253869,
253870,
253931,
253932,
253933,
253934,
253935,
253936,
253937,
253938,
253939,
253940,
253941,
253942,
253943,
253944,
253945,
253946,
253947,
253948,
253949,
253950,
253951,
253952,
253953,
253954,
253955,
253956,
253957,
253958,
253959,
253960,
253961,
253962,
253963,
253964,
253965,
253966,
254306,
254307,
254308,
254309,
254310,
254311,
254312,
254313,
254314,
254315,
254316,
254317,
254318,
254319,
254320,
254321,
254322,
254323,
273781,
273782,
273783,
273784,
273785,
273786,
273787,
273788,
273790,
273791,
273792,
273793,
273794,
273795,
273796,
273797,
273798,
273799,
273800,
273801,
273802,
273803,
273804,
273805,
273806,
273807,
273808,
273809,
273810,
273811,
273812,
273813,
273814,
273815,
273816,
273817,
273818,
273819,
);


foreach ($ids as $id)
{
	$part  = get_part_from_biostor($id);
	
	if (isset($part->Doi) && ($part->Doi != ''))
	{
		echo 'UPDATE rdmp_reference SET doi="' . $part->Doi . '" WHERE reference_id=' . $id . ';' . "\n";
	}
}

?>
