<?php

require_once(dirname(__FILE__) . '/db.php');

$start 	= 264889;
$end 	= 264900;

$ids=array(

101640,
101641,
101642,
101643,
101644,
101645,
101646,
101647,
101648,
101649,
101650,
101651,
101652,
101653,
101654,
101655,
101656,
101657,
101658,
101659,
101660,
101661,
101662,
101663,
101664,
101665,
101666,
101667,
101668,
101669,
101670,
101671,
101672,
101673,
101674,
101675,
101676,
101677,
101678,
101679,
101680,
101681,
101682,
101683,
101684,
101685,
101686,
101687,
101688,
101689,
101690,
101691,
101692,
101693,
101694,
101695,
101696,
101697,
101698,
101699,
101700,
101701,
101702,
101703,
101736,
101737,
101738,
101755,
101772,
101775,
101777,
101778,
101796,
101810,
102392,
127590,
245822,
245823,
);

$ids=array(
100921,
100923,
103852,
10466,
105117,
105121,
105411,
105644,
1058,
106459,
106460,
106461,
106462,
106463,
106464,
106465,
107190,
110629,
117248,
117377,
117379,
11822,
118269,
119396,
119425,
119575,
119742,
11976,
120090,
120097,
120098,
120100,
120101,
120102,
12036,
12100,
12388,
124768,
125750,
12615,
126446,
126448,
126449,
126450,
12647,
12805,
12854,
13074,
13223,
133195,
134047,
134569,
136876,
137548,
13770,
137725,
137812,
137925,
138018,
138030,
138078,
138150,
138156,
139971,
140006,
140014,
141031,
14272,
14507,
146504,
146541,
160514,
166667,
166674,
1846,
185675,
20454,
20543,
209013,
20904,
209050,
209054,
209055,
209056,
209067,
209073,
209074,
209156,
209157,
209160,
209168,
209179,
209180,
228379,
228382,
228383,
228429,
228457,
228495,
228496,
228497,
228498,
228499,
228576,
228577,
228578,
228579,
228581,
228637,
228638,
228690,
228763,
228783,
228787,
228788,
228789,
228790,
228806,
228838,
228839,
228849,
228854,
228855,
228875,
228911,
228935,
228960,
228975,
228983,
228984,
229036,
229116,
229189,
229202,
229203,
229212,
229213,
229217,
229279,
229328,
229335,
229343,
229351,
229352,
229353,
229354,
229378,
229379,
229388,
229399,
229406,
229410,
229413,
229419,
229450,
229461,
229490,
229512,
229513,
229542,
229692,
229739,
229742,
229828,
229835,
229841,
229842,
229843,
229846,
229869,
229870,
229871,
229873,
229874,
229875,
229876,
229877,
229878,
229879,
229880,
229881,
229882,
229883,
229885,
229890,
229902,
229903,
229904,
229905,
229906,
229907,
229908,
229909,
229910,
229911,
229912,
229913,
229914,
229915,
229916,
229917,
229918,
229919,
229920,
229921,
229922,
229923,
229924,
229925,
229926,
229927,
229928,
229929,
229930,
229931,
229933,
229934,
229936,
229938,
229966,
229971,
229998,
230001,
230004,
230007,
230018,
230074,
230203,
230204,
230205,
230248,
230251,
230252,
230265,
230322,
230323,
230324,
230342,
230355,
230372,
230418,
230425,
230431,
230443,
230456,
230457,
230458,
230459,
230460,
230461,
230462,
230463,
230466,
230467,
230468,
230476,
230485,
230486,
230487,
230488,
230489,
230490,
230491,
230492,
230493,
230494,
230495,
230496,
230497,
230498,
230499,
230500,
230501,
230502,
230503,
230504,
230505,
230506,
230507,
230508,
230509,
230510,
230511,
230512,
230513,
230514,
230515,
230516,
230517,
230518,
230519,
230520,
230521,
230522,
230523,
230524,
230525,
230526,
230527,
230528,
230529,
230530,
230531,
230532,
230533,
230534,
230535,
230536,
230537,
230538,
230539,
230540,
230541,
230542,
230543,
230544,
230545,
230546,
230547,
230548,
230549,
230550,
230551,
230552,
230553,
230554,
230555,
230556,
230557,
230558,
230559,
230560,
230561,
230562,
230563,
230564,
230565,
230566,
230567,
230568,
230569,
230570,
230571,
230572,
230573,
230574,
230575,
230576,
230577,
230578,
230579,
230580,
230591,
230600,
230604,
230621,
230643,
230658,
230664,
230671,
230672,
230675,
230681,
230688,
230693,
230699,
230707,
230793,
230825,
230864,
230887,
230890,
230892,
230893,
230895,
230899,
230900,
230901,
230903,
230908,
230912,
230917,
230921,
230926,
230964,
230965,
230966,
230967,
230972,
230973,
230974,
231005,
231032,
231044,
231048,
231049,
231081,
231093,
231101,
231117,
231141,
231142,
231173,
231174,
231211,
231225,
231226,
231227,
231228,
231229,
231256,
231258,
231283,
231285,
231303,
231304,
231305,
231306,
231307,
231308,
231309,
231310,
231311,
231312,
231313,
231314,
231315,
231316,
231317,
231318,
231319,
231320,
231321,
231322,
231323,
231324,
231325,
231326,
231327,
231328,
231329,
231330,
231331,
231332,
231333,
231334,
231335,
231336,
231337,
231338,
231339,
231340,
231341,
231342,
231343,
231344,
231345,
231346,
231347,
231348,
231349,
231350,
231351,
231352,
231353,
231354,
231355,
231356,
231357,
231358,
231359,
231360,
231361,
231362,
231363,
231364,
231365,
231366,
231367,
231368,
231369,
264991,
264992,
264993,
264994,
264995,
264996,
265101,
265102,
265103,
265104,
265105,
265106,
265107,
265108,
265109,
265110,
265111,
265112,
265113,
265114,
265115,
265116,
265117,
265118,
265119,
265120,
265121,
265122,
265123,
265124,
265125,
265551,
265552,
265553,
265554,
3161,
4004,
4147,
49965,
50205,
51416,
52137,
53161,
53478,
53589,
54618,
55570,
56093,
56478,
56721,
56759,
581,
58140,
58388,
59355,
59643,
59675,
61052,
61895,
63027,
63901,
64045,
66011,
66154,
67171,
67222,
67544,
69192,
69350,
69747,
6980,
69934,
70070,
70093,
70095,
70510,
70540,
726,
74728,
74872,
74951,
76845,
77148,
77360,
77741,
78412,
79957,
80020,
80211,
80237,
85448,
85561,
85598,
85678,
87809,
87813,
9489,
95447,
95523,
97152,
97428,
98019,
98020,
99544,
99545,
99546,
99548,
99549,
99550
);

$ids=array(
12388,
133195,
166667,
166674,
20454,
20543,
20904,
231337,
231338,
231339,
231340,
231341,
231342,
231343,
231344,
231345,
231346,
231347,
231348,
231349,
231350,
231351,
231352,
231353,
231354,
231355,
231356,
231357,
231358,
231359,
231360,
231361,
231362,
231363,
231364,
231365,
231366,
231367,
231368,
231369,
4147,
51416,
52137,
53478,
53589,
56478,
56759,
581,
58140,
59355,
59643,
67171,
67222,
69192,
69350,
69747,
6980,
69934,
70070,
70093,
70095,
70510,
70540,
726,
74728,
74872,
74951,
76845,
77148,
77360,
77741,
78412,
79957,
80020,
80211,
80237,
85448,
85561,
85598,
85678,
87809,
87813,
9489,
95447,
95523,
97152,
97428,
99544,
99545,
99546,
99548,
99549,
99550

);

$ids=array(
231337,
231338,
231339,
231340,
231341,
231342,
231343,
231344,
231345,
231346,
231347,
231348,
231349,
231350,
231351,
231352,
231353,
231354,
231355,
231356,
231357,
231358,
231359,
231360,
231361,
231362,
231363,
231364,
231365,
231366,
231367,
231368,
231369,
);

$ids=array(
278033,
);

$force = false;
$force = true;

foreach ($ids as $reference_id)
//for ($reference_id=$start;$reference_id<=$end;$reference_id++)
{
	$go = true;

	echo "-- reference_id = $reference_id\n";
	
	$article = db_retrieve_reference($reference_id);
	
	if ($article == null) break;
	
	//print_r($article);

	$page_range = array();
	
	if (isset($article->spage))
	{
	
		if ($article->spage > 100000)
		{
			$page_range = 
				bhl_page_range_from_pageids($article->spage, $article->epage);
		}
		else
		{	
			if (!$force)
			{
				$pages = bhl_retrieve_reference_pages($reference_id);
				if (isset($pages[0]))
				{
					$go = false;
				
					echo "-- pages OK\n";
				}
			}
	
			if ($go)
			{
			
		
				if (isset($article->spage) && isset($article->epage))
				{
					$page_range = 
						bhl_page_range($article->PageID, $article->epage - $article->spage + 1);
				}
				else
				{
					// No epage, so just get spage (to do: how do we tell user we don't have page range?)
					$page_range = 
						bhl_page_range($article->PageID, 0);				
				}
			}
		}
		
		print_r($page_range);
	
		if ($go)
		{
			echo "DELETE FROM rdmp_reference_page_joiner WHERE reference_id=$reference_id;\n";
		    //echo "UPDATE rdmp_reference SET PageID=" . $page_range[0] . "  WHERE reference_id=$reference_id;\n";
	
			$count = 0;
			foreach ($page_range as $page)
			{
				$sql = 'INSERT INTO rdmp_reference_page_joiner (reference_id, PageID, page_order) VALUES (' . $reference_id . ',' . $page . ',' . $count++ . ');';
				echo $sql . "\n";
		
				//$result = $db->Execute($sql);
				//if ($result == false) die("failed [" . __FILE__ . ":" . __LINE__ . "]: " . $sql);
			}		
		}


	}
}

?>